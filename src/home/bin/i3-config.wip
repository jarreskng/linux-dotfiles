#!/bin/sh

# ------------------------------------------------------
# ---- global variables
# ------------------------------------------------------

readonly PROGPATH=$(readlink -m $(dirname $0))
readonly PROGNAME=$(basename $0)

readonly USER_CONFIG_HOME="${XDG_CONFIG_HOME:-$HOME/.config}"
readonly I3WM_CONFIG_DIR="${USER_CONFIG_HOME}/i3"
readonly I3WM_CONFIG_FILE="${I3WM_CONFIG_DIR}/config"
readonly I3WM_TEMPLATE_FILE="${I3WM_CONFIG_DIR}/template"
readonly I3WM_TEMPORARY_FILE=$(mktemp)

# ------------------------------------------------------
# ---- common functions
# ------------------------------------------------------

function out() { printf "$1 $2\n" "${@:3}"; }
function message() { out "==>" "$@"; }
function error() { out "==> ERROR:" "$@"; } >&2
function warning() { out "==> WARNING:" "$@"; } >&2
function die() { error "$@"; exit 1; }

# ------------------------------------------------------
# ---- parse arguments
# ------------------------------------------------------

# todo later

# ------------------------------------------------------
# ---- ensure that all files and dirs exists
# ------------------------------------------------------

[[ -d "${I3WM_CONFIG_DIR}"    ]] || die "%s does not exist" "${I3WM_CONFIG_DIR}"
[[ -f "${I3WM_TEMPLATE_FILE}" ]] || die "%s does not exist" "${I3WM_TEMPLATE_FILE}"

# ------------------------------------------------------
# ---- create temporary config file
# ------------------------------------------------------

cat << EOF > "${I3WM_TEMPORARY_FILE}"
# ======================================================
# ATTENTION! THIS FILE WAS AUTO-GENERATED BY ${PROGNAME}.
# DO NOT EDIT MANUALLY. ALL CHANGES WILL BE OVERWRITTEN.
# ALSO WE WILL STEAL YOUR CAR AND KILL YOUR FUCKING DOG.
# ======================================================


$(cat ${I3WM_TEMPLATE_FILE})
EOF

# ------------------------------------------------------
# ---- replace inlcude statements by configuration parts
# ------------------------------------------------------



